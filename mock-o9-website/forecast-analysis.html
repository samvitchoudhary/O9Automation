<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>O9 Platform - Forecast Analysis</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <div class="logo">O9 Platform</div>
        <div class="user-info">
            <span id="username-display">testuser</span>
            <button onclick="handleLogout()" class="btn-secondary">Logout</button>
        </div>
    </div>
    
    <div class="container">
        <nav class="sidebar">
            <ul class="nav-menu">
                <li><a href="dashboard.html">← Back to Dashboard</a></li>
            </ul>
        </nav>
        
        <main class="main-content">
            <h1>Forecast Analysis - Advanced View</h1>
            
            <!-- KPI Cards -->
            <div class="kpi-cards">
                <div class="kpi-card">
                    <h3>Forecast Accuracy</h3>
                    <div class="kpi-value" id="forecast-accuracy">87.3%</div>
                    <div class="kpi-trend positive">↑ 2.1% vs Last Month</div>
                </div>
                
                <div class="kpi-card">
                    <h3>Bias</h3>
                    <div class="kpi-value" id="bias">-3.2%</div>
                    <div class="kpi-trend negative">↓ 1.5% vs Last Month</div>
                </div>
                
                <div class="kpi-card">
                    <h3>MAPE</h3>
                    <div class="kpi-value" id="mape">12.8%</div>
                    <div class="kpi-trend positive">↑ 0.8% vs Last Month</div>
                </div>
                
                <div class="kpi-card">
                    <h3>Total Volume</h3>
                    <div class="kpi-value" id="total-volume">145.2K</div>
                    <div class="kpi-trend positive">↑ 5.3% vs Last Month</div>
                </div>
            </div>
            
            <!-- Time Period Selector -->
            <div class="scope-filters">
                <h3>Analysis Period</h3>
                <div class="filter-grid">
                    <div class="filter-item">
                        <label for="time-period">Time Period</label>
                        <select id="time-period" onchange="updateAnalysis()">
                            <option value="last-week">Last Week</option>
                            <option value="last-month" selected>Last Month</option>
                            <option value="last-quarter">Last Quarter</option>
                            <option value="last-year">Last Year</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="aggregation">Aggregation Level</label>
                        <select id="aggregation" onchange="updateAnalysis()">
                            <option value="daily">Daily</option>
                            <option value="weekly" selected>Weekly</option>
                            <option value="monthly">Monthly</option>
                        </select>
                    </div>
                </div>
                
                <button class="btn-primary" onclick="refreshAnalysis()">Refresh Analysis</button>
            </div>
            
            <!-- Chart -->
            <div class="widget" style="margin-top: 20px;">
                <h3>Forecast vs Actual Comparison</h3>
                <canvas id="forecastChart" width="400" height="200"></canvas>
            </div>
            
            <!-- Data Table -->
            <div class="widget" style="margin-top: 20px;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3>Detailed Breakdown by SKU</h3>
                    <button class="btn-secondary" onclick="exportToExcel()">Export to Excel</button>
                </div>
                
                <table class="data-table" id="analysis-table">
                    <thead>
                        <tr>
                            <th>SKU</th>
                            <th>Product Name</th>
                            <th>Forecast</th>
                            <th>Actual</th>
                            <th>Variance</th>
                            <th>Accuracy</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>SKU-001</td>
                            <td>Product Alpha</td>
                            <td>1,250</td>
                            <td>1,180</td>
                            <td class="negative">-70 (-5.6%)</td>
                            <td>94.4%</td>
                            <td><button class="btn-link" onclick="drillDown('SKU-001')">Drill Down</button></td>
                        </tr>
                        <tr>
                            <td>SKU-002</td>
                            <td>Product Beta</td>
                            <td>2,800</td>
                            <td>2,950</td>
                            <td class="positive">+150 (+5.4%)</td>
                            <td>94.9%</td>
                            <td><button class="btn-link" onclick="drillDown('SKU-002')">Drill Down</button></td>
                        </tr>
                        <tr>
                            <td>SKU-003</td>
                            <td>Product Gamma</td>
                            <td>3,500</td>
                            <td>3,445</td>
                            <td class="negative">-55 (-1.6%)</td>
                            <td>98.4%</td>
                            <td><button class="btn-link" onclick="drillDown('SKU-003')">Drill Down</button></td>
                        </tr>
                        <tr>
                            <td>SKU-004</td>
                            <td>Product Delta</td>
                            <td>1,900</td>
                            <td>2,100</td>
                            <td class="positive">+200 (+10.5%)</td>
                            <td>90.5%</td>
                            <td><button class="btn-link" onclick="drillDown('SKU-004')">Drill Down</button></td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- Alert Section -->
            <div class="widget alert-widget" style="margin-top: 20px;">
                <h3>Alerts & Notifications</h3>
                <div class="alert-list">
                    <div class="alert-item warning">
                        <span class="alert-icon">⚠️</span>
                        <div class="alert-content">
                            <strong>High Variance Detected</strong>
                            <p>SKU-004 showing 10.5% over-forecast. Review demand drivers.</p>
                            <span class="alert-time">2 hours ago</span>
                        </div>
                    </div>
                    
                    <div class="alert-item info">
                        <span class="alert-icon">ℹ️</span>
                        <div class="alert-content">
                            <strong>Data Refresh Complete</strong>
                            <p>Latest actuals loaded successfully for January 2026.</p>
                            <span class="alert-time">5 hours ago</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <script src="js/app.js"></script>
    <script src="js/forecast-analysis.js"></script>
</body>
</html>
